import{handleRuntimeError}from"../helpers.js";import{POPOUT_WINDOW_KEY}from"../../constants.js";const returnActivePopoutWindow=async()=>{var o=await chrome.storage.local.get([POPOUT_WINDOW_KEY]);return!!o[POPOUT_WINDOW_KEY]&&await chrome.windows.get(o[POPOUT_WINDOW_KEY]).catch(()=>!1)},popout=async()=>{handleRuntimeError();var o=await returnActivePopoutWindow();o?chrome.windows.update(o.id,{focused:!0}):chrome.windows.create({url:chrome.runtime.getURL("index.html#/popout"),width:490,height:610,type:"popup",focused:!1,top:100,left:100},function(o){chrome.storage.local.set({[POPOUT_WINDOW_KEY]:o.id}),setTimeout(function(){chrome.windows.update(o.id,{focused:!0})},1500)})},setBrowserAction=o=>{o?chrome.action.setPopup({popup:""}):chrome.action.setPopup({popup:"index.html"})},initCommandHandler=()=>{chrome.commands.onCommand.addListener(popout),chrome.windows.onRemoved.addListener(async o=>{handleRuntimeError();var e=await returnActivePopoutWindow();e&&o==e.id&&chrome.storage.local.remove(POPOUT_WINDOW_KEY)}),setBrowserAction(!1),chrome.action.onClicked.addListener(popout)},commandMessageHandler=o=>{"commands"===o.name&&o.onMessage.addListener(function(o){"popout"===o.command&&popout()})};export{initCommandHandler,commandMessageHandler,setBrowserAction,popout};