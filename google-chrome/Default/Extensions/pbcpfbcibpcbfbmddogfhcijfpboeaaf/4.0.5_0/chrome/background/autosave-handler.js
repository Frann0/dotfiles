import{logger}from"../helpers.js";import{stylesService}from"../feathers.js";const autosaveMessageHandler=e=>{let a=!1,s;"autosave"===e.name&&(logger.log("debug","autosaveMessageHandler","port.connected"),e.onMessage.addListener(function(e){e.save?autosave(s,a):e.key&&(a=e.editorValue,s=e.key)}),e.onDisconnect.addListener(()=>{logger.log("debug","autosaveMessageHandler","port.disconnect"),autosave(s,a)}))};function autosave(a,s){stylesService.find({query:{key:a}}).then(e=>{var[e]=e.data;logger.log("debug","autosave",e,a,s),e?s&&s!=e.val?stylesService.patch(e._id,{draft:s}):e.val.length?stylesService.patch(e._id,{draft:!1}):stylesService.remove(e._id):s.length&&stylesService.create({key:a,draft:s,val:""})})}export{autosaveMessageHandler};