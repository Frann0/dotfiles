import{AMINO_APP_URL}from"../../env.js";import{handleRuntimeError,logger,safeGetTab,safeUrl}from"../helpers.js";import{executeScriptOnce}from"../helpers.js";const injectContentScripts=async e=>{var t=chrome.runtime.getManifest(),t=t.content_scripts[0].js.concat(t.content_scripts[1].js);const n=(await safeGetTab(e))["url"];if(safeUrl(n))return executeScriptOnce("__amino_install_scripts_loaded",{target:{tabId:e},files:t}).catch(e=>{logger.log("warn","injectContentScripts",`Failed to inject scripts on tab (${n}): `+e.message)})},initOnInstallHandler=()=>{chrome.runtime.onInstalled.addListener(async e=>{var t;return"install"===e.reason?([e]=await chrome.tabs.query({url:AMINO_APP_URL+"/*"}),t=AMINO_APP_URL+"/create-account?context=extension",e?chrome.tabs.update(e.id,{active:!0,url:t}):chrome.tabs.create({url:t,active:!0}),chrome.storage.sync.set({___extension__flags_just_installed:!0})):chrome.storage.sync.set({___extension__flags_just_updated:!0}),!1}),chrome.runtime.setUninstallURL(AMINO_APP_URL+"/goodbye")};export default initOnInstallHandler;export{initOnInstallHandler,injectContentScripts};