import{logger}from"../helpers.js";import{getOptions}from"./options-messenger.js";import{urlHasStyles}from"./style-messenger.js";const activeIcon="assets/images/icon.png",activeWithStylesIcon="assets/images/icon-badge.png",disabledIcon="assets/images/icon-disabled.png",errorIcon="assets/images/icon-error.png",setStyleErrorIcon=async e=>{chrome.action.setIcon({path:errorIcon,tabId:e})},setIconState=async e=>{logger.log("debug","setIconState","is offline",e);var t,o=await getOptions(),s=(logger.log("debug","setIconState","options",o),logger.log("debug","setIconState","check tab states"),await chrome.tabs.query({}));for(t of s){var a,{id:n,url:c}=t;e||o.disabled?(logger.log("debug","setIconState","disabled"),chrome.action.setIcon({path:disabledIcon,tabId:n})):c&&(logger.log("debug","setIconState","for tab",c),a=await urlHasStyles(c),logger.log("debug","setIconState","hasStyles",c,a),a?chrome.action.setIcon({path:activeWithStylesIcon,tabId:n}):chrome.action.setIcon({path:activeIcon,tabId:n}))}},iconStateListener=()=>setIconState();export{setIconState,setStyleErrorIcon,iconStateListener};